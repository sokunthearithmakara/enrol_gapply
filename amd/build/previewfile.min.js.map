{"version":3,"file":"previewfile.min.js","sources":["../src/previewfile.js"],"sourcesContent":["\nimport $ from \"jquery\";\nimport Notification from 'core/notification';\nimport {add as addToast} from 'core/toast';\n\nexport const init = () => {\n    $(document).on('click', \"a[data-type]\", function() {\n        var modal = `<div class=\"modal fade\" id=\"applyfile\" data-backdrop=\"static\"\n         data-keyboard=\"false\" tabindex=\"-1\" aria-labelledby=\"applyfileLabel\" aria-modal=\"true\" role=\"dialog\">\n                        <div class=\"modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable\">\n                            <div class=\"modal-content\">\n                                <div class=\"modal-header\">\n                                    <h5 class=\"modal-title\" id=\"applyfileLabel\"></h5>\n                                    <button   class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n                                    <i class=\"fa fa-times\" aria-hidden=\"true\"></i>\n                                    </button>\n                                </div>\n                                <div class=\"modal-body p-0 text-center d-flex justify-content-center\">\n                                </div>\n                                <div class=\"modal-footer\">\n                                    <a href=\"javascript:void(0)\" id=\"forcedownloadbutton\"\n                                        class=\"btn btn-primary text-uppercase font-weight-bold\">\n                                        ${M.util.get_string(\"download\", \"enrol_gapply\")}</a>\n                                    <button class=\"btn btn-secondary text-uppercase font-weight-bold\"\n                                        data-dismiss=\"modal\">${M.util.get_string(\"close\", \"enrol_gapply\")}</button>\n                                </div>\n                            </div>\n                        </div>\n                </div>`;\n        // Remove existing modal\n        $(\"#applyfile\").remove();\n        $(\"body\").append(modal);\n        $(\"#applyfileLabel\").html($(this).text());\n        $(\"#applyfile\").modal(\"show\");\n        let html = '';\n        if ($(this).data(\"type\").includes(\"image\")) {\n            $(\"#applyfile .modal-body\").removeClass(\"d-flex\");\n            html = `<img src=\"${$(this).data(\"url\")}\" class=\"img-fluid mx-auto\">`;\n        } else if ($(this).data(\"type\").includes(\"video\")) {\n            html = `<video src=\"${$(this).data(\"url\")}\"\n                    class=\"embed-responsive-item text-center m-0\" controls width=\"100%\" autoplay></video>`;\n        } else if ($(this).data(\"type\").includes(\"audio\")) {\n            $(\"#applyfile .modal-body\").removeClass(\"d-flex\");\n            html = `<audio src=\"${$(this).data(\"url\")}\"\n                    class=\"embed-responsive-item text-center m-0\" controls width=\"100%\" autoplay></audio>`;\n        } else if ($(this).data(\"type\").includes(\"pdf\")) {\n            html = `<object data=\"${$(this).data(\"url\")}\" type=\"application/pdf\"\n                     width=\"100%\" style=\"height: 80vh\">\n                                            <p>${M.util.get_string('cannotopenpdffile', 'enrol_gapply', $(this).data(\"url\"))}</p>\n                                            </object>`;\n        } else if ($(this).data(\"type\").includes(\"officedocument\") || $(this).data(\"type\").includes(\"msword\")\n            || $(this).data(\"type\").includes(\"ms-excel\")\n            || $(this).data(\"type\").includes(\"ms-powerpoint\") || $(this).data(\"type\").includes(\"openxmlformats\")) {\n            html = `<iframe id=\"fileviewer\"\n                    src=\"https://view.officeapps.live.com/op/embed.aspx?src=${$(this).data(\"url\")}\"\n                    class=\"embed-responsive-item\" style=\"width: 100%; height: 80vh\"></iframe>`;\n        } else if ($(this).data(\"type\").includes(\"text\") || $(this).data(\"type\").includes(\"csv\")) {\n            html = `<iframe id=\"fileviewer\"\n                    src=\"https://docs.google.com/viewer?url=${$(this).data(\"url\")}&embedded=true\"\n                    class=\"embed-responsive-item\" style=\"width: 100%; height: 80vh; border-radius: 0\"></iframe>`;\n        } else {\n            $(\"#applyfile .modal-body\").removeClass(\"d-flex\");\n            html = `<p class=\"text-center py-5\">${M.util.get_string('cannotopenfile', 'enrol_gapply', $(this).data(\"url\"))}</p>`;\n        }\n        $(\"#applyfile .modal-body\").html(html);\n        var newURL = new URL($(this).data(\"url\"));\n\n        $(\"#applyfile\").on(\"click\", \"#forcedownloadbutton\", function() {\n            newURL.searchParams.append(\"forcedownload\", 1);\n            window.open(newURL.toString());\n        });\n    });\n\n    $(document).on('click', \"#withdraw\", function(e) {\n        e.preventDefault();\n        const withdraw = () => {\n            $.ajax({\n                method: \"POST\",\n                url: M.cfg.wwwroot + \"/enrol/gapply/ajax.php\",\n                data: {\n                    action: \"withdraw\",\n                    id: $(\".btn#withdraw\").data(\"instance\"),\n                    sesskey: M.cfg.sesskey,\n                },\n                dataType: \"text\",\n                success: () => {\n                    addToast(M.util.get_string('applicationwithdrawnsuccess', 'enrol_gapply'), {\n                        type: 'success'\n                    });\n                    setTimeout(() => {\n                        location.reload();\n                    }, 1000);\n                },\n                error: () => {\n                    addToast(M.util.get_string('anerroroccurred', 'enrol_gapply'), {\n                        type: 'danger'\n                    });\n                }\n            });\n        };\n\n        try { // 4.1 +\n            Notification.deleteCancelPromise(\n                M.util.get_string('withdrawapplication', 'enrol_gapply'),\n                M.util.get_string('withdrawapplicationconfirm', 'enrol_gapply'),\n                M.util.get_string('withdraw', 'enrol_gapply'),\n            ).then(() => {\n                return withdraw();\n            }).catch(() => {\n                return;\n            });\n        } catch { // 4.1\n            Notification.saveCancel(\n                M.util.get_string('withdrawapplication', 'enrol_gapply'),\n                M.util.get_string('withdrawapplicationconfirm', 'enrol_gapply'),\n                M.util.get_string('withdraw', 'enrol_gapply'),\n                function() {\n                    return withdraw();\n                }\n            );\n        }\n    });\n};"],"names":["document","on","modal","M","util","get_string","remove","append","html","this","text","data","includes","removeClass","newURL","URL","searchParams","window","open","toString","e","preventDefault","withdraw","ajax","method","url","cfg","wwwroot","action","id","sesskey","dataType","success","type","setTimeout","location","reload","error","deleteCancelPromise","then","catch","saveCancel"],"mappings":"kZAKoB,yBACdA,UAAUC,GAAG,QAAS,gBAAgB,eAChCC,wrCAe8BC,EAAEC,KAAKC,WAAW,WAAY,qMAETF,EAAEC,KAAKC,WAAW,QAAS,qLAMhF,cAAcC,6BACd,QAAQC,OAAOL,2BACf,mBAAmBM,MAAK,mBAAEC,MAAMC,4BAChC,cAAcR,MAAM,YAClBM,KAAO,IACP,mBAAEC,MAAME,KAAK,QAAQC,SAAS,8BAC5B,0BAA0BC,YAAY,UACxCL,0BAAoB,mBAAEC,MAAME,KAAK,yCAC1B,mBAAEF,MAAME,KAAK,QAAQC,SAAS,SACrCJ,4BAAsB,mBAAEC,MAAME,KAAK,wHAE5B,mBAAEF,MAAME,KAAK,QAAQC,SAAS,8BACnC,0BAA0BC,YAAY,UACxCL,4BAAsB,mBAAEC,MAAME,KAAK,yHAE5B,mBAAEF,MAAME,KAAK,QAAQC,SAAS,OACrCJ,8BAAwB,mBAAEC,MAAME,KAAK,oJAEAR,EAAEC,KAAKC,WAAW,oBAAqB,gBAAgB,mBAAEI,MAAME,KAAK,wEAElG,mBAAEF,MAAME,KAAK,QAAQC,SAAS,oBAAqB,mBAAEH,MAAME,KAAK,QAAQC,SAAS,YACrF,mBAAEH,MAAME,KAAK,QAAQC,SAAS,cAC9B,mBAAEH,MAAME,KAAK,QAAQC,SAAS,mBAAoB,mBAAEH,MAAME,KAAK,QAAQC,SAAS,kBACnFJ,qHACkE,mBAAEC,MAAME,KAAK,4GAExE,mBAAEF,MAAME,KAAK,QAAQC,SAAS,UAAW,mBAAEH,MAAME,KAAK,QAAQC,SAAS,OAC9EJ,qGACkD,mBAAEC,MAAME,KAAK,gKAG7D,0BAA0BE,YAAY,UACxCL,2CAAsCL,EAAEC,KAAKC,WAAW,iBAAkB,gBAAgB,mBAAEI,MAAME,KAAK,qCAEzG,0BAA0BH,KAAKA,UAC7BM,OAAS,IAAIC,KAAI,mBAAEN,MAAME,KAAK,4BAEhC,cAAcV,GAAG,QAAS,wBAAwB,WAChDa,OAAOE,aAAaT,OAAO,gBAAiB,GAC5CU,OAAOC,KAAKJ,OAAOK,sCAIzBnB,UAAUC,GAAG,QAAS,aAAa,SAASmB,GAC1CA,EAAEC,uBACIC,SAAW,qBACXC,KAAK,CACHC,OAAQ,OACRC,IAAKtB,EAAEuB,IAAIC,QAAU,yBACrBhB,KAAM,CACFiB,OAAQ,WACRC,IAAI,mBAAE,iBAAiBlB,KAAK,YAC5BmB,QAAS3B,EAAEuB,IAAII,SAEnBC,SAAU,OACVC,QAAS,oBACI7B,EAAEC,KAAKC,WAAW,8BAA+B,gBAAiB,CACvE4B,KAAM,YAEVC,YAAW,KACPC,SAASC,WACV,MAEPC,MAAO,oBACMlC,EAAEC,KAAKC,WAAW,kBAAmB,gBAAiB,CAC3D4B,KAAM,yCAOLK,oBACTnC,EAAEC,KAAKC,WAAW,sBAAuB,gBACzCF,EAAEC,KAAKC,WAAW,6BAA8B,gBAChDF,EAAEC,KAAKC,WAAW,WAAY,iBAChCkC,MAAK,IACIjB,aACRkB,OAAM,SAGX,4BACeC,WACTtC,EAAEC,KAAKC,WAAW,sBAAuB,gBACzCF,EAAEC,KAAKC,WAAW,6BAA8B,gBAChDF,EAAEC,KAAKC,WAAW,WAAY,iBAC9B,kBACWiB"}