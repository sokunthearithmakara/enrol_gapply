define("enrol_gapply/custom",["jquery","enrol_gapply/jszip","core/toast","enrol_gapply/jquery.dataTables","enrol_gapply/dataTables.bootstrap4","enrol_gapply/dataTables.select","enrol_gapply/select.bootstrap4","enrol_gapply/dataTables.buttons","enrol_gapply/buttons.bootstrap4","enrol_gapply/buttons.html5","enrol_gapply/dataTables.rowGroup","enrol_gapply/rowGroup.bootstrap4","enrol_gapply/buttons.colVis"],(function($,JSZip,toast){return window.JSZip=JSZip,{init:function(tab,id){$("body").on("click","a[data-type]",(function(e){var modal='<div class="modal fade" id="applyfile" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="applyfileLabel" aria-modal="true" role="dialog">\n                                                    <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">\n                                                        <div class="modal-content">\n                                                            <div class="modal-header">\n                                                                <h5 class="modal-title" id="applyfileLabel"></h5>\n                                                                <button class="close" data-dismiss="modal" aria-label="Close">\n                                                                <i class="fa fa-times" aria-hidden="true"></i>\n                                                                </button>\n                                                            </div>\n                                                            <div class="modal-body p-0 text-center d-flex justify-content-center">\n                                                            </div>\n                                                            <div class="modal-footer">\n                                                                <a href="javascript:void(0)" id="forcedownloadbutton"\n                                                                    class="btn btn-primary text-uppercase font-weight-bold">'.concat(M.util.get_string("download","enrol_gapply"),'</a>\n                                                                <button class="btn btn-secondary text-uppercase font-weight-bold"\n                                                                    data-dismiss="modal">').concat(M.util.get_string("close","enrol_gapply"),"</button>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                            </div>");$("#applyfile").remove(),$("body").append(modal),$("#applyfileLabel").html($(this).text()),$("#applyfile").modal("show"),$(this).data("type").includes("image")?$("#applyfile .modal-body").html('<img src="'.concat($(this).data("url"),'" class="img-fluid mx-auto">')).removeClass("d-flex"):$(this).data("type").includes("video")?$("#applyfile .modal-body").html('<video src="'.concat($(this).data("url"),'"\n                    class="embed-responsive-item text-center m-0" controls width="100%" autoplay></video>')):$(this).data("type").includes("audio")?$("#applyfile .modal-body").html('<audio src="'.concat($(this).data("url"),'"\n                    class="embed-responsive-item text-center m-0" controls width="100%" autoplay></audio>')):$(this).data("type").includes("pdf")?$("#applyfile .modal-body").html('<object data="'.concat($(this).data("url"),'" type="application/pdf"\n                     width="100%" style="height: 80vh">\n                                            <p>').concat(M.util.get_string("cannotopenpdffile","enrol_gapply",$(this).data("url")),"</p>\n                                            </object>")):$(this).data("type").includes("officedocument")||$(this).data("type").includes("msword")||$(this).data("type").includes("ms-excel")||$(this).data("type").includes("ms-powerpoint")||$(this).data("type").includes("openxmlformats")?$("#applyfile .modal-body").html('<iframe id="fileviewer"\n                    src="https://view.officeapps.live.com/op/embed.aspx?src='.concat($(this).data("url"),'"\n                    class="embed-responsive-item" style="width: 100%; height: 80vh"></iframe>')):$(this).data("type").includes("text")||$(this).data("type").includes("csv")?$("#applyfile .modal-body").html('<iframe id="fileviewer"\n                    src="https://docs.google.com/viewer?url='.concat($(this).data("url"),'&embedded=true"\n                    class="embed-responsive-item" style="width: 100%; height: 80vh; border-radius: 0"></iframe>')):$("#applyfile .modal-body").html('<p\n                    class="text-center py-5">'.concat(M.util.get_string("cannotopenfile","enrol_gapply",$(this).data("url")),"</p>")).removeClass("d-flex");var newURL=new URL($(this).data("url"));$("#applyfile").on("click","#forcedownloadbutton",(function(e){newURL.searchParams.append("forcedownload",1),window.open(newURL.toString())}))}));var timecreatedIndex=$("th").index($("th.timecreated")),profileFields=[];$("th.profilefield").each((function(index,element){var pr={index:$("th").index($(this)),text:$(this).text()};profileFields.push(pr)}));var option={ajax:{url:M.cfg.wwwroot+"/enrol/gapply/ajax.php"+"?id=".concat(id,"&action=getapplications&tab=").concat(tab,"&sesskey=").concat(M.cfg.sesskey),dataSrc:function(json){return json}},deferRender:!0,rowId:"id",dom:"<'d-flex align-items-start justify-content-between'<'d-flex align-items-start'Bl>f><'#filterregion.w-100 row'>t<'row'<'col-sm-6'i><'col-sm-6'p>>",buttons:[{extend:"copyHtml5",text:'<i class="fa fa-copy fa-fw"></i>',titleAttr:"",className:"btn btn-sm btn-alt-primary",messageTop:null,title:null,exportOptions:{columns:[".exportable"]}},{extend:"csvHtml5",text:'<i class="fa fa-file-csv fa-fw"></i>',titleAttr:"",className:"btn btn-sm btn-alt-primary",exportOptions:{columns:[".exportable"]}},{extend:"excelHtml5",text:'<i class="fa fa-file-excel fa-fw"></i>',titleAttr:"",className:"btn btn-sm btn-alt-primary",exportOptions:{columns:[".exportable"]}},{extend:"colvis",text:'<i class="fa fa-columns fa-fw"></i>',titleAttr:"",className:"btn btn-sm btn-alt-primary",columns:".colvis"}],language:{lengthMenu:"_MENU_",zeroRecords:M.util.get_string("nofound","enrol_gapply"),search:M.util.get_string("search","enrol_gapply"),info:M.util.get_string("datatableinfo","enrol_gapply"),infoEmpty:M.util.get_string("datatableinfoempty","enrol_gapply"),infoFiltered:M.util.get_string("datatableinfofiltered","enrol_gapply"),paginate:{first:M.util.get_string("first","enrol_gapply"),last:M.util.get_string("last","enrol_gapply"),next:M.util.get_string("next","enrol_gapply"),previous:M.util.get_string("previous","enrol_gapply")},select:{rows:{_:M.util.get_string("rowsselected","enrol_gapply")}}},order:[[timecreatedIndex,"desc"]],columnDefs:[{orderable:!1,className:"select-checkbox",targets:0,visible:!$("#gapplytable").hasClass("approved")},{targets:"userdetails",className:"text-truncate"},{targets:"inv",visible:!1},{targets:"noorder",orderable:!1}],initComplete:function(){$("#gapplytable").wrap('<div style="overflow-x:auto;"></div>'),$(".dataTables_length").addClass("mx-1"),$("#gapplytable").addClass("mx-n1"),$(".table-responsive").css("overflow","visible"),$("#gapplytable").removeClass("d-none"),$(".dataTables_filter").addClass("d-flex align-items-start float-right"),$('<a class="btn btn-sm btn-secondary font-weight-bold ml-1" href="javascript:void(0)" id="filters" data-toggle="tooltip" title="Filter" onclick="$(\'#filterregion\').slideToggle(\'fast\', \'swing\')"><i class="fa fa-filter left fa-fw"></i></a>').insertAfter(".dataTables_filter label"),$("#filterregion").css("display","none"),profileFields.forEach((element=>{var index,text;$((index=element.index,text=element.text,'<div class="col-sm-6 col-md-4 col-lg-3 col-xl-2 pl-0 pr-2">\n                                    <div class="form-group mb-1">\n                                        <label for="filter-'.concat(index,'">').concat(text,'</label>\n                                        <input type="text" class="form-control form-control-sm" id="filter-').concat(index,'" data-index="').concat(index,'"/>\n                                    </div>\n                                </div>'))).appendTo("#filterregion")})),$('<div class="dropdown d-inline right small">\n                    <button class="btn btn-sm btn-secondary dropdown-toggle font-weight-bold ml-1" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="fa fa-sort fa-fw"></i>\n                    </button>\n                    <div class="dropdown-menu dropdown-menu-right" id="sortdropdown" aria-labelledby="dropdownMenuButton">\n\n                    </div>\n                </div>').insertAfter("#filters"),profileFields.forEach((element=>{$("#sortdropdown").append('<a class="dropdown-item" href="javascript:void(0)" data-col="'.concat(element.index,'">').concat(element.text,"</a>"))})),$("#sortdropdown").append('<a class="dropdown-item" href="javascript:void(0)" data-col="'.concat(timecreatedIndex,'">').concat(M.util.get_string("timecreated","enrol_gapply"),'</a><div class="dropdown-divider"></div>\n                        <a class="dropdown-item active" href="javascript:void(0)" data-order="desc">').concat(M.util.get_string("desc","enrol_gapply"),'</a>\n                        <a class="dropdown-item" href="javascript:void(0)" data-order="asc">').concat(M.util.get_string("asc","enrol_gapply"),"</a>"))}};$("#gapplytable").hasClass("approved")||(option.select={style:"os",selector:"td:first-child"});var selecteddata,table=$("#gapplytable").DataTable(option);$("body").on("keyup","#filterregion input",(function(){var index=$(this).data("index"),value=$(this).val();table.column(index).search(value,!1,!0).draw()})),$("body").on("click","#sortdropdown.dropdown-menu a",(function(){$(this).data("order")?($(".dropdown-menu a[data-order]").removeClass("active"),$(this).addClass("active")):($(".dropdown-menu a[data-col]").removeClass("active"),$(this).addClass("active"));var colIndex=$(".dropdown-menu a[data-col].active").data("col"),order=$(".dropdown-menu a[data-order].active").data("order");table.order([colIndex,order]).draw()}));let getRowData=(table,rows)=>{$(".action-button:not(.menu-action)").remove(),(selecteddata=table.rows({selected:!0}).data().toArray().map((row=>row[1]))).length>0?$("#gapplytable_length label").after('\n                            <button class="btn btn-sm alert-success action-button" data-action="approve" data-toggle="tooltip" title="'.concat(M.util.get_string("approve","enrol_gapply"),'"><i class="fa fa-fw fa-check"></i></button>\n                            <button class="btn btn-sm alert-info action-button" data-action="waitlist" data-toggle="tooltip" title="').concat(M.util.get_string("waitlist","enrol_gapply"),'"><i class="fa fa-fw fa-stopwatch"></i></button>\n                            <button class="btn btn-sm alert-warning action-button" data-action="reject" data-toggle="tooltip" title="').concat(M.util.get_string("reject","enrol_gapply"),'"><i class="fa fa-fw fa-times"></i></button>\n                            <button class="btn btn-sm alert-danger action-button" data-action="delete" data-toggle="tooltip" title="').concat(M.util.get_string("delete","enrol_gapply"),'"><i class="fa fa-fw fa-trash"></i></button>')):$(".action-button:not(.menu-action)").remove()};table.on("select",(function(e,dt,type,indexes){getRowData(dt)})),table.on("deselect",(function(e,dt,type,indexes){getRowData(dt)})),$(document).on("click",".action-button",(function(){var action=$(this).data("action"),primarybutton="btn-success";if("waitlist"==action?primarybutton="btn-info":"reject"==action?primarybutton="btn-warning":"delete"==action&&(primarybutton="btn-danger"),$(this).hasClass("menu-action")&&(selecteddata=[$(this).data("id")]),"approve"==action)var getGroups=$.ajax({method:"POST",url:M.cfg.wwwroot+"/enrol/gapply/ajax.php",data:{action:"getgroups",id:$("#gapplytable").data("instance"),sesskey:M.cfg.sesskey},dataType:"json"});else getGroups=new Promise(((resolve,reject)=>{resolve([])}));getGroups.then((data=>{var groupoptions="";data.length>0&&(data.forEach((function(group){groupoptions+='<div class="custom-control custom-checkbox">\n                                                        <input type="checkbox" class="custom-control-input groups" id="group-'.concat(group.id,'" name="groups[]" value="').concat(group.id,'">\n                                                        <label class="custom-control-label" for="group-').concat(group.id,'">').concat(group.name,"</label>\n                                                        </div>")})),groupoptions='<div class="form-group mt-3">\n                                                    <label for="groups">'.concat(M.util.get_string("assigngroups","enrol_gapply"),'</label>\n                                                    <div id="groups">').concat(groupoptions,"</div>\n                                                </div>"));var modal='<div class="modal fade" id="approveModal" tabindex="-1" role="dialog" aria-labelledby="approveModalLabel"  aria-hidden="true" style="background: rgba(0,0,0,0.5);">\n                                    <div class="modal-dialog modal-dialog-centered" role="document">\n                                        <div class="modal-content">\n                                            <div class="modal-header">\n                                                <h5 class="modal-title" id="approveModalLabel">'.concat(M.util.get_string(action+"applications","enrol_gapply"),'</h5>\n                                                <button class="close" data-dismiss="modal" aria-label="Close">\n                                                <i class="fa fa-fw fa-times"></i>\n                                                </button>\n                                                </div>\n                                            <div class="modal-body">\n                                                <p class="mb-0">').concat(M.util.get_string("areyousureyouwantto"+action,"enrol_gapply"),"</p>\n                                                ").concat(groupoptions,'\n                                            </div>\n                                            <div class="modal-footer">\n                                                <button   class="btn btn-secondary text-uppercase font-weight-bold" data-dismiss="modal">').concat(M.util.get_string("cancel","enrol_gapply"),'</button>\n                                                <button   class="btn ').concat(primarybutton,' text-uppercase font-weight-bold" id="proceed">').concat(M.util.get_string("proceed","enrol_gapply"),"</button>\n\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>");$("#approveModal").remove(),$("body").append(modal),$("#approveModal").modal("show"),$("#approveModal #proceed").click((function(){$("#approveModal").modal("hide"),$("#enrol-gapply-loading").toggleClass("d-none d-flex"),$.ajax({url:"/enrol/gapply/ajax.php",method:"POST",data:{action:action,ids:selecteddata.toString(),id:$("#gapplytable").data("instance"),groups:$("#approveModal input.groups:checked").map((function(){return this.value})).get().toString(),sesskey:M.cfg.sesskey},success:function(data){location.reload()},error:function(data){location.reload()}})}))}))})),$(document).on("click",".showuserdetail",(function(){$("#enrol-gapply-loading").toggleClass("d-none d-flex");var userid=$(this).data("userid"),applicationid=$(this).data("id"),status=$(this).data("statusformatted"),sts=$(this).data("status");selecteddata=[applicationid];var applicationtext=$(".applicationtext[data-id='"+applicationid+"']").html(),attachments=[];$('#gapplytable a.attachmentlink[data-id="'+applicationid+'"]').each((function(){var file={link:$(this).data("url"),filename:$(this).text(),type:$(this).data("type")};attachments.push(file)}));var select="";attachments.length>0&&(select='<select class="custom-select w-100 my-2" id="fileselect">',attachments.forEach((function(attachment){select+='<option data-type="'.concat(attachment.type,'" value="').concat(attachment.link,'">').concat(attachment.filename,"</option>")})),select+="</select>"),$.ajax({url:M.cfg.wwwroot+"/enrol/gapply/ajax.php?action=getuserbyid&id=".concat(id,"&userid=")+userid+"&sesskey="+M.cfg.sesskey,type:"GET"}).fail((response=>{var modal='<div class="modal fade" id="userdetailModal" tabindex="-1" role="dialog" aria-labelledby="userdetailModalLabel" aria-hidden="true">\n                                        <div class="modal-dialog modal-xl" role="document" style="max-width: calc(100% - 2rem);">\n                                            <div class="modal-content">\n                                            '.concat(response.responseText,"\n                                            </div>\n                                        </div>\n                                    </div>");$("#userdetailModal").remove(),$("body").append(modal),$("#userdetailModal").modal("show"),"approved"==sts&&$("#userdetailModal .action-button").remove(),$("#enrol-gapply-loading").toggleClass("d-none d-flex"),$("#userdetailModal .select-input").html(select),$("#userdetailModal #applicationtext").html(applicationtext),$("#userdetailModal #currentstatus").html(status);$("#fileselect").change((function(){var url,type,name;url=$(this).val(),type=$(this).find(":selected").data("type"),name=$(this).find(":selected").text(),$(".fileview #viewer").html(name),type.includes("image")?$(".fileview #viewer").html('<img src="'.concat(url,'" class="img-fluid mx-auto">')):type.includes("video")?$(".fileview #viewer").html('<video src="'.concat(url,'"\n                    class="embed-responsive-item text-center m-0" controls width="100%" autoplay></video>')):type.includes("audio")?$(".fileview #viewer").html('<audio src="'.concat(url,'"\n                    class="embed-responsive-item text-center m-0" controls width="100%" autoplay></audio>')):type.includes("pdf")?$(".fileview #viewer").html('<object data="'.concat(url,'" type="application/pdf"\n                     width="100%" style="height: calc(100% - 7px);">\n                                            <p>').concat(M.util.get_string("cannotopenpdffile","enrol_gapply",url),"</p>\n                                            </object>")):type.includes("officedocument")||type.includes("msword")||type.includes("ms-excel")||type.includes("ms-powerpoint")||type.includes("openxmlformats")?$(".fileview #viewer").html('<iframe id="fileviewer"\n                    src="https://view.officeapps.live.com/op/embed.aspx?src='.concat(url,'"\n                    class="embed-responsive-item" style="width: 100%; height: calc(100% - 7px);"></iframe>')):type.includes("text")||type.includes("csv")?$(".fileview #viewer").html('<iframe id="fileviewer"\n                    src="https://docs.google.com/viewer?url='.concat(url,'&embedded=true"\n                    class="embed-responsive-item" style="width: 100%; height:  calc(100% - 7px); border-radius: 0"></iframe>')):$(".fileview #viewer").html('<p\n                    class="text-center py-5">'.concat(M.util.get_string("cannotopenfile","enrol_gapply",url),"</p>")),$("#userdetailmodalLabel").html(name),$("#downloadbutton").attr("href",url)})),$("#fileselect").trigger("change")})).done((response=>{$("#enrol-gapply-loading").toggleClass("d-none d-flex"),window.console.log(response)}))})),$(document).on("click","#selectall",(function(){$(this).is(":checked")?table.rows({search:"applied"}).select():table.rows().deselect()}))}}}));

//# sourceMappingURL=custom.min.js.map